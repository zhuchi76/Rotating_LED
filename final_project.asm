	ORG 0000H   		;初始PC位址
	JMP INITIAL   		;跳至INITIAL
	ORG 1BH   		;將指令從1BH擺
	JMP TIMER1   		;跳至TIMER1
	ORG 0050H 		;將指令從50H擺
INITIAL:  
	SETB ET1    		;ET1=1   timer1 enable
	CLR TF1 		;TF1=0
	SETB EA    		;EA=1   啟動中斷功能
	SETB PT1    		;PT1=1   set priority
	MOV TMOD,#10H   	;Mode1 T1:16-bit Timer
	MOV TL1,#95		;(65536-57761us)/256的餘數 
	MOV TH1,#30 		;(65536-57761us)/256的商 
	SETB TR1		;run
		
	MOV R1,#2		;R1為中斷幾次才是完整的一圈
	MOV R2,#1		;R2為亮暗flag
	WORDS EQU R3		;WORDS是字數
	SIGN EQU R4		;SIGN是校徽顯示
	MOV SIGN,#0		
	SNDK EQU R5		;SNDK就是SIGN是否要DARK的flag
	MOV SNDK,#0
MAIN:
	MOV R0, #0		;從表格第0個開始顯示
	MOV P0, #0FFH		;沒有進入中斷的話 LED全部關掉
	MOV P1,#0FFH
	MOV P2, #0FFH
	MOV 0C0H,#0FFH
MAIN1:
	MOV A,R2
	MOV DPTR, #TABLE	;將表格移至DPTR
	MOV WORDS, #16		;字數設定為16字
	JNZ NEXT_COLUMN		;如果有進入中斷的話 就開始輸出到LED
	JZ MAIN1		;如果沒有進入中斷的話 就等待中斷

NEXT_WORDS:
	INC DPTR			
	DJNZ R0,NEXT_WORDS		;讓DPTR加上16
NEXT_COLUMN:
	CALL PRINTSIGN
	CALL READ_BYTE			;將表格中的值移至A
	MOV P2, A			;A輸出至P2
	CALL READ_BYTE			;將表格中的值移至A
	MOV 0C0H,A			;A輸出至0C0H
	CALL DELAY			;Delay LED從暗到全亮的時間
	CJNE R0, #32, NEXT_COLUMN	;判斷是否已顯示一個字
	MOV A,R2			;判斷輸出過程有沒有中斷過
	JZ MAIN				;有中斷立即跳回MAIN
	DJNZ WORDS, NEXT_WORDS		;判斷是否已顯示所有字
	MOV R2,#0			;輸出所有字便不再輸出
	JMP MAIN			;跳回MAIN
READ_BYTE:
	MOV A, R0			;將索引值移至A
	INC R0				;索引移至下一位置
	MOVC A, @A+DPTR			;取出對應表格值				
	RET

PRINTSIGN:
	CJNE SNDK,#3,PRINTSIGN1		;SNDK沒到三就會直接進入PRINTSIGN1
	MOV P0, SIGN			;將SIGN輸出給P0
	MOV A,SIGN			
	CPL A				;SIGN反向
	MOV SIGN,A			
	MOV P1, SIGN			:將反向後的SIGN輸出給P1
	MOV SNDK,#0			;SNDK歸0
RET
PRINTSIGN1:
	MOV P0, #0FFH			;P0輸出全暗
	MOV P1, #0FFH			;P1輸出全暗
	INC SNDK			;SNDK加一
RET	

TIMER1: 
	CLR TF1				;TF1=0
	MOV TL1,#95   			;(65536-57761us)/256的餘數   
	MOV TH1,#30    			;(65536-57761us)/256的商
	DJNZ R1,RETURN			;兩次中斷才算完整的一圈
	MOV R1,#2			;更新R1
	MOV R2,#1			;R2變成1 可以開始輸出到LED
RETURN:
	RETI				;中斷返回


DELAY:	
	MOV R6, #10	;1us			
DELAY1:
	MOV R7,#40	
DELAY2:
	DJNZ R7,DELAY2
	DJNZ R6,DELAY1	;40us
RET			;2us

TABLE:
	//國
	DB 0FFH,0FFH,0FFH,0FFH,001H,000H,0FBH,0BFH,05BH,0B4H,05BH,0B5H,05BH,0B5H,05BH,0B4H
	DB 0DBH,0AFH,003H,0B6H,0DBH,0B9H,053H,0B6H,04BH,0A3H,0FBH,0BFH,001H,000H,0FBH,0FFH
	
	//立
	DB 0FFH,0FFH,0EFH,0BFH,0EFH,0BFH,0AFH,0BFH,06FH,0BCH,0EFH,0A1H,0EDH,0BFH,0E3H,0BFH
	DB 0EFH,0BFH,0EFH,08FH,0EFH,0B1H,02FH,0BEH,0AFH,0BFH,0E7H,0BFH,0EFH,09FH,0FFH,0BFH

	//陽
	DB 0FFH,0FFH,001H,000H,0FBH,0EFH,09BH,0CFH,061H,0EEH,0FBH,0F1H,07FH,0F7H,07FH,0FBH
	DB 041H,0EBH,055H,0ACH,055H,0B5H,055H,0D9H,055H,0ADH,041H,031H,07FH,09DH,07FH,0E1H

	//明
	DB 0FFH,0FFH,0FFH,0FFH,001H,0F0H,0BBH,0FBH,0BBH,0FBH,0BBH,0FBH,001H,070H,0FBH,0BFH
	DB 0FFH,0CFH,001H,0F0H,0DBH,0FDH,0DBH,0DDH,0DBH,0BDH,0DBH,03DH,001H,080H,0FBH,0FFH

	//交
	DB 0FFH,0FFH,077H,07FH,077H,07FH,0B7H,07FH,0D7H,0BFH,0D7H,0BFH,077H,0DEH,0F5H,0E9H
	DB 0F3H,0F7H,0F7H,0EBH,0F7H,0EDH,077H,0DEH,0D7H,0DFH,0B7H,0BFH,033H,03FH,077H,0BEH

	//通
	DB 0FFH,0FFH,0DDH,03DH,0DBH,0BCH,053H,0CDH,09FH,0D1H,0FFH,0BFH,01BH,0A0H,0BBH,07AH
	DB 0ABH,07AH,01BH,040H,09BH,07AH,0ABH,06AH,0B1H,04AH,01BH,060H,0BFH,0BFH,0FFH,0BFH
	
	//大
	DB 0FFH,0FFH,0DFH,07FH,0DFH,07FH,0DFH,0BFH,0DFH,0DFH,0DFH,0EFH,0DFH,0F3H,0DFH,0FCH
	DB 001H,0FEH,0DDH,0FDH,0DFH,0F3H,0DFH,0EFH,0DFH,0DFH,0DFH,0BFH,0CFH,03FH,0DFH,0BFH

	//學
	DB 0FFH,0FFH,0FFH,0FBH,0FFH,0ECH,001H,0EEH,0ABH,0EEH,0ADH,0EAH,0FFH,0EAH,055H,0AAH
	DB 0BBH,02AH,055H,08AH,0FFH,0E2H,0ABH,0EAH,0ABH,0EEH,001H,0EAH,0FBH,0ECH,0FFH,0FEH

	//空格
	DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH
	DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH

	//電
	DB 0FFH,0FFH,0DFH,0FFH,0E3H,0FFH,057H,0FFH,055H,0C1H,055H,0D5H,0B5H,0D5H,0F5H,0D5H
	DB 001H,001H,0F5H,055H,0B5H,055H,055H,055H,055H,041H,057H,07FH,0E3H,00FH,0F7H,0BFH

	//機
	DB 0FFH,0FFH,0EFH,0F8H,02FH,0FFH,001H,000H,0EDH,0FEH,0EFH,0F9H,0B7H,0DEH,093H,06EH
	DB 0A5H,070H,09BH,0A6H,001H,0BEH,0FFH,0D0H,0B7H,0CEH,093H,0B2H,025H,07AH,09BH,01EH

	//工
	DB 0FFH,0FFH,0FFH,0BFH,0F7H,0BFH,0F7H,0BFH,0F7H,0BFH,0F7H,0BFH,0F7H,0BFH,0F7H,0BFH
	DB 007H,080H,0F7H,0BFH,0F7H,0BFH,0F7H,0BFH,0F7H,0BFH,0F3H,0BFH,0F7H,09FH,0FFH,0BFH

	//程
	DB 0FFH,0FFH,0DBH,0F7H,0DBH,0F9H,05BH,0FEH,001H,000H,0DDH,0FEH,0DDH,0FDH,0FFH,07FH
	DB 081H,076H,0DBH,076H,0DBH,076H,05BH,000H,05BH,077H,05BH,073H,041H,037H,0FBH,07FH

	//學
	DB 0FFH,0FFH,0FFH,0FBH,0FFH,0ECH,001H,0EEH,0ABH,0EEH,0ADH,0EAH,0FFH,0EAH,055H,0AAH
	DB 0BBH,02AH,055H,08AH,0FFH,0E2H,0ABH,0EAH,0ABH,0EEH,001H,0EAH,0FBH,0ECH,0FFH,0FEH

	//系
	DB 0FFH,0FFH,0EFH,0FFH,0EFH,07FH,0EFH,0BDH,0B7H,0CDH,0B7H,0ECH,099H,0BCH,02DH,03DH
	DB 0B7H,081H,0BBH,0FDH,0CFH,0FDH,06FH,0EDH,0FFH,0DCH,0FFH,099H,0FFH,03FH,0FFH,0FFH
	
	//空格
	DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH
	DB 0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH,0FFH

END